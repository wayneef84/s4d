# TODO List - January 16, 2026

**Session:** Week 2, Day 2
**Claude Usage:** Session 62%, Weekly 13%
**Status:** Handoff to Gemini for War fixes

---

## ‚úÖ COMPLETED BY CLAUDE

### 1. Terminal Check Gate Verification
- [x] Verified Terminal Check Gate is already implemented in engine.js
- [x] Confirmed it works correctly (no changes needed)
- [x] Documented flow in CARD_ENGINE_GUIDE.md

### 2. Card Engine Documentation
- [x] Created comprehensive CARD_ENGINE_GUIDE.md (400+ lines)
- [x] Documented architecture, state machine, data structures
- [x] Added API reference, debugging guide, future roadmap
- [x] Living document for LLMs and humans

### 3. War UI Improvements
- [x] Moved Reset Game button to header (icon-only üîÑ)
- [x] Positioned next to Settings and History buttons
- [x] Added tooltips for all header buttons
- [x] Removed old button placement

### 4. War Match History Enhancement
- [x] Enhanced history tracking with detailed match data
- [x] Table display: Date | Winner | Your Points | Opp Points
- [x] Backward compatible with old format
- [x] Full reset now clears history
- [x] Shows last 50 matches
- [x] Fixed history entry timing (was recording 0 points)

### 5. War Issues Documentation
- [x] Created WAR_ISSUES.md with console log analysis
- [x] Identified root cause: Endless mode defaulting to false
- [x] Documented all symptoms and fixes needed

### 6. Gemini Handoff Documentation
- [x] Created FOR_GEMINI_WAR_FIXES.md with complete punchlist
- [x] 5 specific tasks with exact line numbers
- [x] Code snippets for all changes
- [x] Testing checklist
- [x] Status report template
- [x] Commit message template

---

## üîÑ HANDOFF TO GEMINI (G)

### Files for G to Read:
1. **`FOR_GEMINI_WAR_FIXES.md`** ‚≠ê PRIMARY - Complete instructions
2. **`WAR_ISSUES.md`** - Background on issues found
3. **`games/cards/war/index.html`** - File to edit
4. **`games/cards/war/ruleset.js`** - File to verify

### Tasks for G (Summary):

#### Task 1: Fix Endless Mode Default ‚≠ê CRITICAL
**File:** `games/cards/war/index.html` line ~1010
**Change:** In `_loadSettings()` method
```javascript
// BEFORE:
WarRuleset.neverending = saved.neverending !== undefined ? saved.neverending : true;

// AFTER:
WarRuleset.neverending = saved.neverending !== false;
// AND ensure isEndlessMode is synced
```

#### Task 2: Fix Settings Checkbox Default
**File:** `games/cards/war/index.html` line ~528
**Change:** Add `checked` attribute
```html
<!-- BEFORE: -->
<input type="checkbox" id="cfgNeverending">

<!-- AFTER: -->
<input type="checkbox" id="cfgNeverending" checked>
```

#### Task 3: Verify Ruleset Default
**File:** `games/cards/war/ruleset.js` line 40
**Verify:** Should say `neverending: true` (don't change if correct)

#### Task 4: Fix History Display Updates
**File:** `games/cards/war/index.html`
**Add these lines:**
```javascript
// Line ~792 in _handleDeckDepletion():
if (winner) {
    this._addHistoryEntry(winner === 'player1' ? 'win' : 'lose');
    this._updateHistoryDisplay(); // ADD THIS LINE
}

// Line ~841 in _handleGameOver():
this._addHistoryEntry(winner === 'player1' ? 'win' : 'lose');
this._updateHistoryDisplay(); // ADD THIS LINE
```

#### Task 5: Test Everything
**Run complete testing checklist from FOR_GEMINI_WAR_FIXES.md**

---

## üìä G's DELIVERABLES

### Required Status Report

**G: When you're done, create this report in a new file:**

**File:** `GEMINI_STATUS_REPORT.md`

**Template:**
```markdown
# Gemini Status Report - War Game Fixes

**Date:** [Your date]
**Model:** [Gemini version]
**Time Spent:** [Estimate]
**Completion:** [X/5 tasks]

## ‚úÖ Completed Tasks:
- [ ] Task 1: Endless mode default fixed
- [ ] Task 2: Settings checkbox updated
- [ ] Task 3: Ruleset default verified
- [ ] Task 4: History display fixed
- [ ] Task 5: All tests passed

## üß™ Test Results:

### Endless Mode (Default):
- Console shows `Endless: true`: ‚úÖ/‚ùå
- Graveyard accumulates cards: ‚úÖ/‚ùå
- Deck count fluctuates (not stuck at 52): ‚úÖ/‚ùå
- Wins display shows ‚àû: ‚úÖ/‚ùå

### Non-Endless Mode:
- Match ends when deck depletes: ‚úÖ/‚ùå
- History entry created: ‚úÖ/‚ùå
- History modal displays matches: ‚úÖ/‚ùå
- Stats update correctly: ‚úÖ/‚ùå

### Console Output Sample:
```
[Paste console logs showing Endless: true and Graveyard count]
```

## üêõ Issues Encountered:
[Describe any problems]

## üìù Files Modified:
- `games/cards/war/index.html` - [What you changed]
- `games/cards/war/ruleset.js` - [What you changed]

## üéØ For Claude's Next Session:
[What still needs work, if anything]

## ‚ùì Questions for Wayne:
[Any clarifications needed]
```

### Required Commit

**G: Use this commit message when done:**

```bash
git add games/cards/war/index.html games/cards/war/ruleset.js GEMINI_STATUS_REPORT.md
git commit -m "fix(war): Set endless mode as default and fix history display

- Default endless mode to true in _loadSettings()
- Check 'Endless Mode' checkbox by default in settings modal
- Add _updateHistoryDisplay() calls after match ends
- Verify ruleset neverending defaults to true

Fixes:
- Deck now decreases as cards go to graveyard
- Graveyard recycles cards in endless mode
- History modal displays match entries
- Wins show ‚àû in endless mode

Console now shows:
- Endless: true (default)
- Graveyard: [accumulating count]
- History entries logged

Tested in both endless and non-endless modes

Co-Authored-By: Gemini [your model version]"

git push
```

---

## üîô CLAUDE'S NEXT SESSION TASKS

**When Claude returns (after usage resets):**

### Immediate:
1. Review Gemini's status report
2. Verify War fixes are working
3. Test both endless and non-endless modes
4. Check history modal display

### Then Continue With:
1. **Theme System** (25-35k tokens)
   - Create `/games/cards/shared/themes.js`
   - CSS injection architecture
   - Default themes (Classic, Felt Green, Blue Velvet, Dark Mode)
   - Theme selector UI component

2. **Blackjack Double Down Fix** (5-8k tokens)
   - Only available on first move (2 cards)
   - Deduct bet correctly
   - Deal exactly 1 card
   - Force stand immediately

3. **Blackjack Testing** (2-3k tokens)
   - Verify Reset Deck functionality
   - Test Re-shuffle preservation
   - Verify Terminal Check Gate

4. **Optional: Animation Bug Fix** (6-10k tokens)
   - Card preview before flying animation

---

## üìÅ FILES CREATED THIS SESSION

### Documentation:
- `games/cards/shared/CARD_ENGINE_GUIDE.md` - Comprehensive engine docs
- `WAR_ISSUES.md` - Console log analysis and issues
- `FOR_GEMINI_WAR_FIXES.md` - Complete punchlist for G
- `260116_TODO.md` - This file

### Code Changes:
- `games/cards/war/index.html` - UI improvements, history enhancement
- `.gitignore` - Already existed, no changes this session

---

## üéØ SUCCESS CRITERIA

### For Gemini:
- [ ] All 5 tasks completed
- [ ] Console shows `Endless: true` by default
- [ ] Graveyard count > 0 when playing
- [ ] History modal shows match entries
- [ ] All tests pass
- [ ] Status report created
- [ ] Changes committed and pushed

### For Claude (Next Session):
- [ ] War game works correctly in endless mode
- [ ] History displays matches properly
- [ ] Ready to move on to theme system
- [ ] No regressions in Blackjack

---

## üìû COMMUNICATION

### For Gemini:
- **Read:** `FOR_GEMINI_WAR_FIXES.md` first
- **Create:** `GEMINI_STATUS_REPORT.md` when done
- **Commit:** Use template commit message
- **Push:** To main branch

### For Claude:
- **Check:** `GEMINI_STATUS_REPORT.md` first thing next session
- **Verify:** Test War game functionality
- **Continue:** With theme system or other priorities
- **Update:** This TODO with progress

---

## üí° NOTES

### Why Gemini for This Task:
- Focused, well-defined fixes
- Exact line numbers provided
- Low risk (reverting is easy if needed)
- Frees Claude for higher-level tasks

### Why Claude Returns After:
- Review quality of fixes
- Continue with theme system (complex architecture)
- Handle any unexpected issues
- Maintain project continuity

---

## üöÄ READY FOR HANDOFF

**Gemini:** Start with `FOR_GEMINI_WAR_FIXES.md`

**Claude:** See you next session! Review `GEMINI_STATUS_REPORT.md` first.

**Wayne:** You're all set to hand this to G!

---

**Last Updated:** January 16, 2026 by Claude Sonnet 4.5
**Next Update:** By Gemini (G) after completing fixes
